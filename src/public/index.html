<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Inmo24x7 — Demo</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; margin: 0; background: #0b1020; color: #fff; }
      .wrap { max-width: 820px; margin: 0 auto; padding: 24px; }
      .card { background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.12); border-radius: 16px; padding: 16px; }
      .row { display: flex; gap: 10px; margin-top: 12px; }
      input { flex: 1; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,.15); background: rgba(255,255,255,.05); color: #fff; }
      button { padding: 12px 14px; border-radius: 12px; border: 0; background: #1abc9c; font-weight: 700; cursor: pointer; }
      .chat { margin-top: 14px; display: flex; flex-direction: column; gap: 10px; }
      .bubble { max-width: 90%; padding: 10px 12px; border-radius: 14px; line-height: 1.35; border: 1px solid rgba(255,255,255,.12); white-space: pre-wrap; }
      .me { align-self: flex-end; background: rgba(26,188,156,.18); }
      .bot { align-self: flex-start; background: rgba(255,255,255,.06); }
      .top { display: flex; justify-content: space-between; gap: 10px; align-items: center; }
      .muted { color: rgba(255,255,255,.7); font-size: 13px; }
      .smallbtn { background: rgba(255,255,255,.08); color: #fff; border: 1px solid rgba(255,255,255,.12); }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="card">
        <div class="top">
          <div>
            <div style="font-weight:800;font-size:18px;">Inmo24x7 — Demo</div>
            <div class="muted">Simulador de conversación (misma lógica que /message)</div>
          </div>
          <button class="smallbtn" id="resetBtn">Reset</button>
        </div>

        <div class="chat" id="chat"></div>

        <div class="row">
          <input id="msg" placeholder="Escribí un mensaje (ej: hola)" />
          <button id="send">Enviar</button>
        </div>
        <div class="muted" style="margin-top:10px;">Tip: probá: hola → alquiler → Palermo → 1200 → sí</div>
      </div>
    </div>

    <script>
      const chat = document.getElementById("chat");
      const input = document.getElementById("msg");
      const sendBtn = document.getElementById("send");
      const resetBtn = document.getElementById("resetBtn");

      const userId = "demo-ui";

      function addBubble(text, who) {
        const div = document.createElement("div");
        div.className = `bubble ${who}`;
        div.textContent = text;
        chat.appendChild(div);
        chat.scrollTop = chat.scrollHeight;
      }

      async function send(text) {
        addBubble(text, "me");
        input.value = "";

        const res = await fetch("/message", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ userId, text })
        });

        const data = await res.json();
        (data.messages || []).forEach(m => addBubble(m, "bot"));
      }

      sendBtn.onclick = () => {
        const t = input.value.trim();
        if (t) send(t);
      };

      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") sendBtn.onclick();
      });

      resetBtn.onclick = () => send("/reset");

      // Auto start
      send("hola");
    </script>
  </body>
</html>
